<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8"/>
	<title>Jogo Fiap</title>
	</head>
<body>
	<canvas id="minha-tela" width="800" height="400" style="border: #F00 solid 1px;"> </canvas>
	
	<!-- Nave normal -->
	<div style="display:none;">
		<img id="nave"
				 src="imagens/nave.svg"
				 width="50" height="50">
	</div>

	<!-- Nave 90 -->
	<div style="display:none;">
		<img id="nave90"
				 src="imagens/nave90.svg"
				 width="50" height="50">
	</div>

	<!-- Nave 180 -->
	<div style="display:none;">
		<img id="nave180"
				 src="imagens/nave180.svg"
				 width="50" height="50">
	</div>

	<!-- Nave 270 -->
	<div style="display:none;">
		<img id="nave270"
				 src="imagens/nave270.svg"
				 width="50" height="50">
	</div>

	<!-- Asteroide -->
	<div style="display:none;">
		<img id="asteroide"
				 src="imagens/asteroide.svg"
				 width="50" height="50">
	</div>

	<script>  
		// Le imagens da nave e do asteroide
		var nave = document.getElementById('nave');
		var asteroide = document.getElementById('asteroide');

		var canvas = document.getElementById('minha-tela'); 
		var ctx = canvas.getContext('2d');
		
		//definir o ínicio do desenho
		var x = canvas.width / 2;
		var y = 350;

		// Definir o início do inimigo
		var x_inimigo = Math.floor((Math.random() * canvas.width));
		var y_inimigo = 0;

		// Obtendo o valor do momento em que o jogo é iniciado
		var tInicial = new Date().getTime();
		var intervalo, tAtual;

		// Tempo para geração de novos inimigos
		var fps = 1/3;

		// Movimentação da nave ao pressionar teclas
		window.onkeydown = pressionaTecla;

    function pressionaTecla(tecla){
				if(tecla.keyCode == 39  ) {
					if (x <= 750) x = x + 5; //aumentar o x tem o efeito de ir para a direita
					nave = document.getElementById('nave270');
				}

				if(tecla.keyCode == 37  ) {
					if (x >= 0) x = x - 5; //diminuir o x tem o efeito de ir para a esquerda
					nave = document.getElementById('nave90')
				}	
			
				if(tecla.keyCode == 38  ) {
					if (y >= 0) y = y - 5; //diminuir y tem o efeito de subida
					nave = document.getElementById('nave');
				}

				if(tecla.keyCode == 40  ) {
					if (y <= 350) y = y + 5; //aumentar y tem o efeito de descer
					nave = document.getElementById('nave180');
				}
    }

		//a função gameloop é chamada aqui
		requestAnimationFrame(gameloop);
		function gameloop() {
			// Pontuação
			tAtual = new Date().getTime();
      intervalo = Math.floor((tAtual - tInicial)/1000); // Compara o tempo atual com o inicial para definir a pontuação
		
			renderizarJogo(x,y, intervalo);

			// Chama a função que verifica a colisão, e caso exista, finaliza o jogo
			detectarColisao();
		}


		function renderizarJogo(pX, pY, x) {
			ctx.clearRect(0, 0, 800, 400); //antes de fazer o desenho é preciso limpar o canvas

			desenharQuadrado(pX,pY);
			pontos(x);

			// Faz com que a posição no eixo Y do inimigo caia constantemente para criar o efeito de queda
			y_inimigo += 2;
		}

		function desenharQuadrado(pX,pY) {
			//desenha o asteroide
			ctx.drawImage(asteroide, x_inimigo, y_inimigo, 50, 50);
      //desenha a nave
			ctx.drawImage(nave, pX, pY, 50, 50);
		}

		// Exibe a pontuação na tela
		function pontos(x) {
				// Exibe a pontuação atual no canvas
	    	ctx.strokeText('PONTOS: '+ x,canvas.width-150,canvas.height-10);
		}		

		// Da o Game Over
		function gameOver() {
				ctx.font = "64px Helvetica";
				ctx.fillStyle = "red";
				ctx.fillText("GAME OVER",canvas.width/2-150,canvas.height/2);
		}

		// Detecta se há colisão e dá game over caso sim
		function detectarColisao() {
         if( ( (x_inimigo + 50) >  x && x_inimigo < (x + 50) ) && ( (y_inimigo + 50) > y && y_inimigo < (y + 50))) {
						gameOver()
         }
				else {
					//chama novamente o ciclo da animação
					requestAnimationFrame(gameloop);
				}
     }

		// Cria um inimigo em uma posição diferente a cada x segundos
		 function criaInimigo() {
    		setTimeout(function() {
					requestAnimationFrame(criaInimigo);
					x_inimigo = Math.floor((Math.random() * canvas.width));
					y_inimigo = 0;
    		}, 1000 / fps);
		}

		criaInimigo();


	</script>  
</body>
</html>

